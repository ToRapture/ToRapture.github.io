<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"torapture.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Some notes">
<meta property="og:type" content="website">
<meta property="og:title" content="ToRapture&#39;s Blog">
<meta property="og:url" content="https://torapture.github.io/page/5/index.html">
<meta property="og:site_name" content="ToRapture&#39;s Blog">
<meta property="og:description" content="Some notes">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="ToRapture">
<meta property="article:tag" content="ToRapture, Linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://torapture.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>ToRapture's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ToRapture's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">A Programmer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2020/03/31/Token-Bucket-Algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/31/Token-Bucket-Algorithm/" class="post-title-link" itemprop="url">Token Bucket Algorithm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-31 16:04:00 16:04:00" itemprop="dateCreated datePublished" datetime="2020-03-31T16:04:00+08:00">2020-03-31 16:04:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/03/31/Token-Bucket-Algorithm/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/31/Token-Bucket-Algorithm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="reference">Reference</h2>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Token_bucket">Token bucket</a></p>
<blockquote>
<p>Over the long run the output of conformant packets is limited by the token rate, <span class="math inline">\({\displaystyle r}\)</span>.</p>
</blockquote>
<h2 id="implementation">Implementation</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">    logger <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/x-cray/logrus-prefixed-formatter&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.SetFormatter(&amp;prefixed.TextFormatter&#123;</span><br><span class="line">        TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>,</span><br><span class="line">        FullTimestamp:   <span class="literal">true</span>,</span><br><span class="line">        ForceFormatting: <span class="literal">true</span>,</span><br><span class="line">        DisableColors:   <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    logger.SetOutput(os.Stdout)</span><br><span class="line">    logger.SetLevel(logger.DebugLevel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TokenBucket <span class="keyword">struct</span> &#123;</span><br><span class="line">    mu              sync.Mutex</span><br><span class="line">    startTime       time.Time</span><br><span class="line">    availableTokens <span class="keyword">int64</span></span><br><span class="line">    capacity        <span class="keyword">int64</span></span><br><span class="line">    fillInterval    time.Duration</span><br><span class="line">    lastTick        <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTokenBucket</span><span class="params">(qps, capacity <span class="keyword">int64</span>)</span> *<span class="title">TokenBucket</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;TokenBucket&#123;</span><br><span class="line">        startTime:       time.Now(),</span><br><span class="line">        availableTokens: capacity,</span><br><span class="line">        capacity:        capacity,</span><br><span class="line">        lastTick:        <span class="number">0</span>,</span><br><span class="line">        fillInterval:    time.Duration(<span class="keyword">int64</span>(time.Second) / qps),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tb *TokenBucket)</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (tb.availableTokens) &gt;= tb.capacity &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    now := time.Now()</span><br><span class="line">    tick := <span class="keyword">int64</span>(now.Sub(tb.startTime) / tb.fillInterval)</span><br><span class="line">    tb.availableTokens += tick - tb.lastTick</span><br><span class="line">    <span class="keyword">if</span> tb.availableTokens &gt; tb.capacity &#123;</span><br><span class="line">        tb.availableTokens = tb.capacity</span><br><span class="line">    &#125;</span><br><span class="line">    tb.lastTick = tick</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tb *TokenBucket)</span> <span class="title">TakeAvailable</span><span class="params">(count <span class="keyword">int64</span>)</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">    tb.mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> tb.mu.Unlock()</span><br><span class="line"></span><br><span class="line">    tb.adjust()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tb.availableTokens &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count &gt;= tb.availableTokens &#123;</span><br><span class="line">        count = tb.availableTokens</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tb.availableTokens -= count</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">task</span><span class="params">(qps, num <span class="keyword">int64</span>, timeNeed time.Duration)</span></span> &#123;</span><br><span class="line">    logger.Infof(<span class="string">&quot;task qps: %v, num: %v, timeNeed: %.3fs&quot;</span>, qps, num, timeNeed.Seconds())</span><br><span class="line">    bucket := NewTokenBucket(qps, qps)</span><br><span class="line">    startTime := time.Now()</span><br><span class="line">    lastTime := startTime</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">int64</span>(<span class="number">1</span>); i &lt;= num; &#123;</span><br><span class="line">        <span class="keyword">if</span> bucket.TakeAvailable(<span class="number">1</span>) == <span class="number">1</span> &#123;</span><br><span class="line">            time.Sleep(timeNeed)</span><br><span class="line">            i++</span><br><span class="line">            <span class="keyword">if</span> i%<span class="number">1000</span> == <span class="number">0</span> &#123;</span><br><span class="line">                now := time.Now()</span><br><span class="line">                logger.Infof(<span class="string">&quot;rate: %.3f&quot;</span>, <span class="number">1000</span>/now.Sub(lastTime).Seconds())</span><br><span class="line">                lastTime = now</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    logger.Infof(<span class="string">&quot;task over, used: %.3fs&quot;</span>, time.Now().Sub(startTime).Seconds())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    task(<span class="number">10000</span>, <span class="number">100000</span>, <span class="number">0</span>)</span><br><span class="line">    task(<span class="number">10000</span>, <span class="number">15000</span>, <span class="number">2</span>*time.Millisecond)</span><br><span class="line">    task(<span class="number">500</span>, <span class="number">10000</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">[2020-03-31 15:58:49]  INFO task qps: 10000, num: 100000, timeNeed: 0.000s</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6698910.757</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6132110.182</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6394802.305</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6386511.687</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 5484591.041</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6646770.666</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 5725671.621</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6449490.813</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 5718631.875</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 6620981.892</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 10174.362</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 9999.993</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 9999.979</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 10000.032</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 9999.993</span><br><span class="line">[2020-03-31 15:58:49]  INFO rate: 10000.001</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 9999.981</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 9750.039</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 10263.124</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 10000.008</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 10000.004</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 10000.006</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 9999.980</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 10000.013</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 10000.008</span><br><span class="line">[2020-03-31 15:58:50]  INFO rate: 9999.989</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 10000.006</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 10000.002</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 10000.002</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 9999.990</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 9999.990</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 10000.004</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 10000.008</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 10000.004</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 9999.999</span><br><span class="line">[2020-03-31 15:58:51]  INFO rate: 9999.994</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 10000.011</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 9999.991</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 9865.780</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 10137.923</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 9999.998</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 10000.009</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 10000.000</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 9999.998</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 10000.000</span><br><span class="line">[2020-03-31 15:58:52]  INFO rate: 10000.000</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 10000.002</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 10000.006</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 9999.994</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 9999.992</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 9999.989</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 10000.026</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 9999.996</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 10000.001</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 9999.975</span><br><span class="line">[2020-03-31 15:58:53]  INFO rate: 10000.015</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10000.008</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 9999.993</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10000.011</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 9998.373</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10001.612</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10000.003</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10000.010</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10000.000</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 10000.000</span><br><span class="line">[2020-03-31 15:58:54]  INFO rate: 9999.988</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 10000.005</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 10000.007</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 9999.996</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 9999.999</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 9999.976</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 10000.032</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 9999.998</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 10000.000</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 9999.990</span><br><span class="line">[2020-03-31 15:58:55]  INFO rate: 10000.001</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 9999.999</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 9999.993</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 10000.012</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 10000.001</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 10000.005</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 9999.996</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 9999.993</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 9999.999</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 10000.008</span><br><span class="line">[2020-03-31 15:58:56]  INFO rate: 9999.996</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 9998.998</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 10001.010</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 9999.992</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 10000.004</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 9999.997</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 9999.988</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 10000.012</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 9999.996</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 10000.012</span><br><span class="line">[2020-03-31 15:58:57]  INFO rate: 9999.998</span><br><span class="line">[2020-03-31 15:58:58]  INFO rate: 9999.991</span><br><span class="line">[2020-03-31 15:58:58]  INFO rate: 9999.990</span><br><span class="line">[2020-03-31 15:58:58]  INFO rate: 10000.020</span><br><span class="line">[2020-03-31 15:58:58]  INFO rate: 9999.995</span><br><span class="line">[2020-03-31 15:58:58]  INFO task over, used: 9.000s</span><br><span class="line">[2020-03-31 15:58:58]  INFO task qps: 10000, num: 15000, timeNeed: 0.002s</span><br><span class="line">[2020-03-31 15:59:00]  INFO rate: 397.098</span><br><span class="line">[2020-03-31 15:59:03]  INFO rate: 396.814</span><br><span class="line">[2020-03-31 15:59:05]  INFO rate: 397.583</span><br><span class="line">[2020-03-31 15:59:08]  INFO rate: 391.641</span><br><span class="line">[2020-03-31 15:59:10]  INFO rate: 391.799</span><br><span class="line">[2020-03-31 15:59:13]  INFO rate: 400.202</span><br><span class="line">[2020-03-31 15:59:15]  INFO rate: 402.581</span><br><span class="line">[2020-03-31 15:59:18]  INFO rate: 405.188</span><br><span class="line">[2020-03-31 15:59:20]  INFO rate: 396.681</span><br><span class="line">[2020-03-31 15:59:23]  INFO rate: 397.131</span><br><span class="line">[2020-03-31 15:59:25]  INFO rate: 398.076</span><br><span class="line">[2020-03-31 15:59:28]  INFO rate: 398.811</span><br><span class="line">[2020-03-31 15:59:30]  INFO rate: 399.199</span><br><span class="line">[2020-03-31 15:59:33]  INFO rate: 400.549</span><br><span class="line">[2020-03-31 15:59:36]  INFO rate: 390.775</span><br><span class="line">[2020-03-31 15:59:36]  INFO task over, used: 37.732s</span><br><span class="line">[2020-03-31 15:59:36]  INFO task qps: 500, num: 10000, timeNeed: 0.000s</span><br><span class="line">[2020-03-31 15:59:37]  INFO rate: 1002.004</span><br><span class="line">[2020-03-31 15:59:39]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:41]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:43]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:45]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:47]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:49]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:51]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:53]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:55]  INFO rate: 500.000</span><br><span class="line">[2020-03-31 15:59:55]  INFO task over, used: 19.000s</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2020/03/30/External-sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/30/External-sort/" class="post-title-link" itemprop="url">External sort</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 18:46:00 18:46:00" itemprop="dateCreated datePublished" datetime="2020-03-30T18:46:00+08:00">2020-03-30 18:46:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/03/30/External-sort/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/30/External-sort/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="comparison-sorts">Comparison sorts</h2>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Best</th>
<th>Average</th>
<th>Worst</th>
<th>Memory</th>
<th>Stable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bubble sort</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(n^2\)</span></td>
<td><span class="math inline">\(n^2\)</span></td>
<td><span class="math inline">\(1\)</span></td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Insertion sort</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(n^2\)</span></td>
<td><span class="math inline">\(n^2\)</span></td>
<td><span class="math inline">\(1\)</span></td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Merge sort</td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n\)</span></td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Heapsort</td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(1\)</span></td>
<td>No</td>
</tr>
<tr class="odd">
<td>Quicksort</td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n\log n\)</span></td>
<td><span class="math inline">\(n^2\)</span></td>
<td><span class="math inline">\(\log n\)</span></td>
<td>No</td>
</tr>
</tbody>
</table>
<h2 id="external-sort">External sort</h2>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/External_sorting">External sorting</a></p>
<p><code>external.cpp</code>: <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DBG(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_MEM = <span class="number">128</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 128MB</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BUF_SIZE = <span class="number">64</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">write_temp_file</span><span class="params">(<span class="keyword">int</span> file_no, <span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; &amp;strings)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> temp_file = to_string(file_no) + <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">    FILE *f_temp = fopen(temp_file.c_str(), <span class="string">&quot;w&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;s : strings) &#123;</span><br><span class="line">        <span class="built_in">fputs</span>(s.c_str(), f_temp);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(f_temp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temp_file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">sort_part_to_disk</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;input_file)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; temp_files;</span><br><span class="line"></span><br><span class="line">    FILE *f_input = fopen(input_file.c_str(), <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> temp_size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> file_no = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[BUF_SIZE];</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; strings;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (fgets(buf, <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>, f_input) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">string</span> str = buf;</span><br><span class="line">        temp_size += str.size();</span><br><span class="line">        strings.push_back(str);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (temp_size &gt;= MAX_MEM) &#123;</span><br><span class="line">            sort(strings.begin(), strings.end());</span><br><span class="line">            <span class="built_in">string</span> temp_file = write_temp_file(file_no, strings);</span><br><span class="line">            temp_files.push_back(temp_file);</span><br><span class="line"></span><br><span class="line">            file_no++;</span><br><span class="line">            strings.clear();</span><br><span class="line">            temp_size = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!strings.empty()) &#123;</span><br><span class="line">        sort(strings.begin(), strings.end());</span><br><span class="line">        <span class="built_in">string</span> temp_file = write_temp_file(file_no, strings);</span><br><span class="line">        temp_files.push_back(temp_file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fclose(f_input);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temp_files;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">external_sort</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;input_file, <span class="keyword">const</span> <span class="built_in">string</span> &amp;output_file)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; temp_files = sort_part_to_disk(input_file);</span><br><span class="line">    <span class="built_in">vector</span>&lt;FILE *&gt; files;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;file_name : temp_files) &#123;</span><br><span class="line">        FILE *temp_file = fopen(file_name.c_str(), <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        files.push_back(temp_file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FILE *f_output = fopen(output_file.c_str(), <span class="string">&quot;w&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">priority_queue</span>&lt;<span class="built_in">pair</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;, <span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;&gt;, greater&lt;<span class="built_in">pair</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;&gt;&gt; pri_que;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> have_input = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        have_input = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; temp_files.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> buf[BUF_SIZE];</span><br><span class="line">            <span class="keyword">if</span> (fgets(buf, <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>, files[i]) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                have_input = <span class="literal">true</span>;</span><br><span class="line">                pri_que.push(<span class="built_in">pair</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;(buf, temp_files[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!pri_que.empty()) &#123;</span><br><span class="line">            <span class="built_in">pair</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; top = pri_que.top();</span><br><span class="line">            pri_que.pop();</span><br><span class="line">            <span class="built_in">fputs</span>(top.first.c_str(), f_output);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (have_input || !pri_que.empty());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (FILE *f : files) &#123;</span><br><span class="line">        fclose(f);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(f_output);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    external_sort(<span class="string">&quot;raw.txt&quot;</span>, <span class="string">&quot;output.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> torapture@localhost ~&#x2F;SSD&#x2F;Codes&#x2F;acm ls -lh raw.txt</span><br><span class="line">-rwxrwxrwx  1 torapture  staff   685M  3 30 18:02 raw.txt</span><br><span class="line"></span><br><span class="line"> torapture@localhost ~&#x2F;SSD&#x2F;Codes&#x2F;acm time .&#x2F;external</span><br><span class="line">.&#x2F;external  617.04s user 17.50s system 94% cpu 11:10.99 total</span><br><span class="line"></span><br><span class="line"> torapture@localhost ~&#x2F;SSD&#x2F;Codes&#x2F;acm time sort .&#x2F;raw.txt &gt; sort.txt</span><br><span class="line">sort .&#x2F;raw.txt &gt; sort.txt  496.36s user 87.25s system 81% cpu 11:58.01 total</span><br><span class="line"></span><br><span class="line"> torapture@localhost ~&#x2F;SSD&#x2F;Codes&#x2F;acm ls -lh raw.txt output.txt sort.txt</span><br><span class="line">-rwxrwxrwx  1 torapture  staff   685M  3 30 18:13 output.txt</span><br><span class="line">-rwxrwxrwx  1 torapture  staff   685M  3 30 18:02 raw.txt</span><br><span class="line">-rwxrwxrwx  1 torapture  staff   685M  3 30 18:28 sort.txt</span><br><span class="line"> torapture@localhost ~&#x2F;SSD&#x2F;Codes&#x2F;acm diff output.txt sort.txt</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2020/03/30/Map-in-Golang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/30/Map-in-Golang/" class="post-title-link" itemprop="url">Map in Golang</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 15:09:00 15:09:00" itemprop="dateCreated datePublished" datetime="2020-03-30T15:09:00+08:00">2020-03-30 15:09:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/03/30/Map-in-Golang/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/30/Map-in-Golang/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="reference">Reference</h2>
<p><a target="_blank" rel="noopener" href="https://blog.golang.org/maps">Go maps in action</a> <a target="_blank" rel="noopener" href="https://golang.org/ref/spec#Comparison_operators">Comparison operators</a></p>
<h2 id="declaration-and-initialization">Declaration and initialization</h2>
<blockquote>
<p>A Go map type looks like this: <code>map[KeyType]ValueType</code> where KeyType may be any type that is comparable (more on this later), and ValueType may be any type at all, including another map!</p>
</blockquote>
<h2 id="key-types">Key types</h2>
<p>As mentioned earlier, map keys may be of any type that is comparable. The language spec defines this precisely, but in short, comparable types are boolean, numeric, string, pointer, channel, and interface types, and structs or arrays that contain only those types. Notably absent from the list are slices, maps, and functions; these types cannot be compared using ==, and may not be used as map keys.</p>
<h2 id="code">Code</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">    logger <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/x-cray/logrus-prefixed-formatter&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.SetFormatter(&amp;prefixed.TextFormatter&#123;</span><br><span class="line">        TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>,</span><br><span class="line">        FullTimestamp:   <span class="literal">true</span>,</span><br><span class="line">        ForceFormatting: <span class="literal">true</span>,</span><br><span class="line">        DisableColors:   <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    logger.SetOutput(os.Stdout)</span><br><span class="line">    logger.SetLevel(logger.DebugLevel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">    Y <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mp := <span class="keyword">map</span>[Foo]<span class="keyword">int</span>&#123;</span><br><span class="line">        Foo&#123;</span><br><span class="line">            Y: [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">        &#125;: <span class="number">256</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    logger.Infof(<span class="string">&quot;mp: %+v&quot;</span>, mp)</span><br><span class="line"></span><br><span class="line">    mp = <span class="keyword">map</span>[Foo]<span class="keyword">int</span>&#123;</span><br><span class="line">        Foo&#123;</span><br><span class="line">            Y: <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;,</span><br><span class="line">        &#125;: <span class="number">256</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    logger.Infof(<span class="string">&quot;mp: %+v&quot;</span>, mp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Results: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">panic: runtime error: hash of unhashable type map[int]int</span><br><span class="line">[2020-03-30 15:06:32]  INFO mp: map[&#123;Y:[1 2 3]&#125;:256]</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">main.main()</span><br><span class="line">    &#x2F;Users&#x2F;torapture&#x2F;Codes&#x2F;repos&#x2F;go&#x2F;src&#x2F;go-learn&#x2F;main.go:33 +0x1a2</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2020/03/27/Slice-in-Golang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/27/Slice-in-Golang/" class="post-title-link" itemprop="url">Slice in Golang</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-27 16:24:00 16:24:00" itemprop="dateCreated datePublished" datetime="2020-03-27T16:24:00+08:00">2020-03-27 16:24:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/03/27/Slice-in-Golang/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/27/Slice-in-Golang/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="blogs">Blogs</h2>
<p><a target="_blank" rel="noopener" href="https://blog.golang.org/slices-intro">Go Slices: usage and internals</a><br />
<a target="_blank" rel="noopener" href="https://blog.golang.org/slices">Arrays, slices (and strings): The mechanics of 'append'</a></p>
<h2 id="details">Details</h2>
<h3 id="make">make</h3>
<p>Look up in <code>$GOROOT/src/runtime/slice.go:makeslice</code>.</p>
<h3 id="append">append</h3>
<p>https://stackoverflow.com/a/33405824/13133551</p>
<h3 id="slicing">slicing</h3>
<blockquote>
<p>The length is the number of elements referred to by the slice. The capacity is the number of elements in the underlying array (beginning at the element referred to by the slice pointer).</p>
</blockquote>
<h3 id="copy">copy</h3>
<p>Look up in <code>$GOROOT/src/runtime/slice.go:slicecopy</code>.</p>
<blockquote>
<p>The copy function supports copying between slices of different lengths (it will copy only up to the smaller number of elements). In addition, copy can handle source and destination slices that share the same underlying array, handling overlapping slices correctly.</p>
</blockquote>
<h2 id="codes">Codes</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">    logger <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/x-cray/logrus-prefixed-formatter&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">assertPanic</span><span class="params">(v <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !v &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;v is not true&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.SetFormatter(&amp;prefixed.TextFormatter&#123;</span><br><span class="line">        TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>,</span><br><span class="line">        FullTimestamp:   <span class="literal">true</span>,</span><br><span class="line">        ForceFormatting: <span class="literal">true</span>,</span><br><span class="line">        DisableColors:   <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    logger.SetOutput(os.Stdout)</span><br><span class="line">    logger.SetLevel(logger.DebugLevel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sliceCopy</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.Infof(<span class="string">&quot;in sliceCopy&quot;</span>)</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        s = <span class="built_in">append</span>(s, i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">copy</span>(c, s)</span><br><span class="line">    logger.Infof(<span class="string">&quot;c: %v&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="built_in">copy</span>(c, s)</span><br><span class="line">    logger.Infof(<span class="string">&quot;c: %v&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">15</span>)</span><br><span class="line">    <span class="built_in">copy</span>(c, s)</span><br><span class="line">    logger.Infof(<span class="string">&quot;c: %v&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">20</span>)</span><br><span class="line">    <span class="built_in">copy</span>(c, s)</span><br><span class="line">    logger.Infof(<span class="string">&quot;c: %v&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">    c[<span class="number">0</span>] = <span class="number">256</span></span><br><span class="line">    logger.Infof(<span class="string">&quot;c: %v, s: %v&quot;</span>, c, s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sliceAppend</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.Infof(<span class="string">&quot;in sliceAppend&quot;</span>)</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        s = <span class="built_in">append</span>(s, i)</span><br><span class="line">        logger.Infof(<span class="string">&quot;after appending: %v, len(s): %v, cap(s): %v&quot;</span>, i, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        l := <span class="built_in">len</span>(s)</span><br><span class="line">        c := <span class="built_in">cap</span>(s)</span><br><span class="line">        after := <span class="built_in">append</span>(s, i)</span><br><span class="line">        <span class="keyword">if</span> l == c &#123;</span><br><span class="line">            assertPanic(&amp;s[<span class="number">0</span>] != &amp;after[<span class="number">0</span>])</span><br><span class="line">            assertPanic(s[<span class="number">0</span>] == after[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">            s[<span class="number">0</span>] += <span class="number">8</span></span><br><span class="line">            assertPanic(s[<span class="number">0</span>] != after[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            assertPanic(&amp;s[<span class="number">0</span>] == &amp;after[<span class="number">0</span>])</span><br><span class="line">            assertPanic(s[<span class="number">0</span>] == after[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">            s[<span class="number">0</span>] += <span class="number">8</span></span><br><span class="line">            assertPanic(s[<span class="number">0</span>] == after[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        s = after</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resultOfAppend</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.Infof(<span class="string">&quot;in resultOfAppend&quot;</span>)</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    s = <span class="built_in">append</span>(s, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    x := <span class="built_in">append</span>(s, <span class="number">16</span>)</span><br><span class="line">    assertPanic(x[<span class="number">5</span>] == <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    y := <span class="built_in">append</span>(s, <span class="number">32</span>)</span><br><span class="line">    assertPanic(x[<span class="number">5</span>] == <span class="number">32</span>)</span><br><span class="line">    assertPanic(y[<span class="number">5</span>] == <span class="number">32</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slicing</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logger.Infof(<span class="string">&quot;in slicing&quot;</span>)</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    s = <span class="built_in">append</span>(s, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    y := s[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">    assertPanic(<span class="built_in">len</span>(y) == <span class="number">2</span>)</span><br><span class="line">    assertPanic(<span class="built_in">cap</span>(y) == <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    y[<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line">    assertPanic(s[<span class="number">1</span>] == <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    y = <span class="built_in">append</span>(y, <span class="number">8</span>)</span><br><span class="line">    assertPanic(s[<span class="number">3</span>] == <span class="number">8</span>)</span><br><span class="line">    assertPanic(y[<span class="number">2</span>] == <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    s[<span class="number">3</span>] = <span class="number">32</span></span><br><span class="line">    assertPanic(y[<span class="number">2</span>] == <span class="number">32</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    sliceCopy()</span><br><span class="line">    sliceAppend()</span><br><span class="line">    resultOfAppend()</span><br><span class="line">    slicing()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Result: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[2020-03-27 16:04:59]  INFO in sliceCopy</span><br><span class="line">[2020-03-27 16:04:59]  INFO c: []</span><br><span class="line">[2020-03-27 16:04:59]  INFO c: [0 1 2 3 4]</span><br><span class="line">[2020-03-27 16:04:59]  INFO c: [0 1 2 3 4 5 6 7 8 9 0 0 0 0 0]</span><br><span class="line">[2020-03-27 16:04:59]  INFO c: [0 1 2 3 4]</span><br><span class="line">[2020-03-27 16:04:59]  INFO c: [256 1 2 3 4], s: [0 1 2 3 4 5 6 7 8 9]</span><br><span class="line">[2020-03-27 16:04:59]  INFO in sliceAppend</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 0, len(s): 1, cap(s): 1</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 1, len(s): 2, cap(s): 2</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 2, len(s): 3, cap(s): 4</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 3, len(s): 4, cap(s): 4</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 4, len(s): 5, cap(s): 8</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 5, len(s): 6, cap(s): 8</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 6, len(s): 7, cap(s): 8</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 7, len(s): 8, cap(s): 8</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 8, len(s): 9, cap(s): 16</span><br><span class="line">[2020-03-27 16:04:59]  INFO after appending: 9, len(s): 10, cap(s): 16</span><br><span class="line">[2020-03-27 16:04:59]  INFO in resultOfAppend</span><br><span class="line">[2020-03-27 16:04:59]  INFO in slicing</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/29/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%8D%E4%B8%AD%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E9%80%92%E5%BD%92%E8%BD%AC%E5%BE%AA%E7%8E%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%8D%E4%B8%AD%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E9%80%92%E5%BD%92%E8%BD%AC%E5%BE%AA%E7%8E%AF/" class="post-title-link" itemprop="url"></a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-29 17:39:00 17:39:00" itemprop="dateCreated datePublished" datetime="2019-12-29T17:39:00+08:00">2019-12-29 17:39:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/29/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%8D%E4%B8%AD%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E9%80%92%E5%BD%92%E8%BD%AC%E5%BE%AA%E7%8E%AF/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/29//" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DBG(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    Node *left, *right;</span><br><span class="line"></span><br><span class="line">    Node() : left(<span class="literal">NULL</span>), right(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    Node(<span class="keyword">int</span> val) : val(val), left(<span class="literal">NULL</span>), right(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> StackState &#123;</span><br><span class="line">    AFTER_PUSH_ROOT = <span class="number">0</span>,</span><br><span class="line">    AFTER_PUSH_LEFT = <span class="number">1</span>,</span><br><span class="line">    AFTER_PUSH_RIGHT = <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_pre_order</span><span class="params">(Node *root, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ret)</span> </span>&#123;</span><br><span class="line">    ret.push_back(root-&gt;val);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) dfs_pre_order(root-&gt;left, ret);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right) dfs_pre_order(root-&gt;right, ret);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_in_order</span><span class="params">(Node *root, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ret)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) dfs_in_order(root-&gt;left, ret);</span><br><span class="line">    ret.push_back(root-&gt;val);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right) dfs_in_order(root-&gt;right, ret);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_post_order</span><span class="params">(Node *root, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ret)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) dfs_post_order(root-&gt;left, ret);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right) dfs_post_order(root-&gt;right, ret);</span><br><span class="line">    ret.push_back(root-&gt;val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre_order</span><span class="params">(Node *root, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ret)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="built_in">pair</span>&lt;Node *, StackState&gt;&gt; stk;</span><br><span class="line">    stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(root, AFTER_PUSH_ROOT));</span><br><span class="line">    <span class="keyword">while</span> (!stk.empty()) &#123;</span><br><span class="line">        <span class="built_in">pair</span>&lt;Node *, StackState&gt; &amp;top = stk.top();</span><br><span class="line">        <span class="keyword">switch</span> (top.second) &#123;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_ROOT:</span><br><span class="line">                ret.push_back(top.first-&gt;val);</span><br><span class="line">                <span class="keyword">if</span> (top.first-&gt;left) stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(top.first-&gt;left, AFTER_PUSH_ROOT));</span><br><span class="line">                top.second = AFTER_PUSH_LEFT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_LEFT:</span><br><span class="line">                <span class="keyword">if</span> (top.first-&gt;right) stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(top.first-&gt;right, AFTER_PUSH_ROOT));</span><br><span class="line">                top.second = AFTER_PUSH_RIGHT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_RIGHT:</span><br><span class="line">                stk.pop();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">in_order</span><span class="params">(Node *root, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ret)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="built_in">pair</span>&lt;Node *, StackState&gt;&gt; stk;</span><br><span class="line">    stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(root, AFTER_PUSH_ROOT));</span><br><span class="line">    <span class="keyword">while</span> (!stk.empty()) &#123;</span><br><span class="line">        <span class="built_in">pair</span>&lt;Node *, StackState&gt; &amp;top = stk.top();</span><br><span class="line">        <span class="keyword">switch</span> (top.second) &#123;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_ROOT:</span><br><span class="line">                <span class="keyword">if</span> (top.first-&gt;left) stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(top.first-&gt;left, AFTER_PUSH_ROOT));</span><br><span class="line">                top.second = AFTER_PUSH_LEFT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_LEFT:</span><br><span class="line">                ret.push_back(top.first-&gt;val);</span><br><span class="line">                <span class="keyword">if</span> (top.first-&gt;right) stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(top.first-&gt;right, AFTER_PUSH_ROOT));</span><br><span class="line">                top.second = AFTER_PUSH_RIGHT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_RIGHT:</span><br><span class="line">                stk.pop();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">post_order</span><span class="params">(Node *root, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ret)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="built_in">pair</span>&lt;Node *, StackState&gt;&gt; stk;</span><br><span class="line">    stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(root, AFTER_PUSH_ROOT));</span><br><span class="line">    <span class="keyword">while</span> (!stk.empty()) &#123;</span><br><span class="line">        <span class="built_in">pair</span>&lt;Node *, StackState&gt; &amp;top = stk.top();</span><br><span class="line">        <span class="keyword">switch</span> (top.second) &#123;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_ROOT:</span><br><span class="line">                <span class="keyword">if</span> (top.first-&gt;left) stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(top.first-&gt;left, AFTER_PUSH_ROOT));</span><br><span class="line">                top.second = AFTER_PUSH_LEFT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_LEFT:</span><br><span class="line">                <span class="keyword">if</span> (top.first-&gt;right) stk.push(<span class="built_in">pair</span>&lt;Node *, StackState&gt;(top.first-&gt;right, AFTER_PUSH_ROOT));</span><br><span class="line">                top.second = AFTER_PUSH_RIGHT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AFTER_PUSH_RIGHT:</span><br><span class="line">                ret.push_back(top.first-&gt;val);</span><br><span class="line">                stk.pop();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Node *<span class="title">get_tree</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    Node *root = <span class="keyword">new</span> Node(random());</span><br><span class="line">    <span class="built_in">vector</span>&lt;Node *&gt; nodes;</span><br><span class="line">    nodes.push_back(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> pos = random() * random() * random() % nodes.size();</span><br><span class="line">        <span class="keyword">if</span> (nodes[pos]-&gt;left == <span class="literal">NULL</span> &amp;&amp; nodes[pos]-&gt;right == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (random() % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                nodes[pos]-&gt;left = <span class="keyword">new</span> Node(random());</span><br><span class="line">                nodes.push_back(nodes[pos]-&gt;left);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                nodes[pos]-&gt;right = <span class="keyword">new</span> Node(random());</span><br><span class="line">                nodes.push_back(nodes[pos]-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nodes[pos]-&gt;left) &#123;</span><br><span class="line">            nodes[pos]-&gt;right = <span class="keyword">new</span> Node(random());</span><br><span class="line">            nodes.push_back(nodes[pos]-&gt;right);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nodes[pos]-&gt;left = <span class="keyword">new</span> Node(random());</span><br><span class="line">            nodes.push_back(nodes[pos]-&gt;left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (nodes[pos]-&gt;left &amp;&amp; nodes[pos]-&gt;right) &#123;</span><br><span class="line">            nodes.erase(nodes.begin() + pos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free_tree</span><span class="params">(Node *root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) free_tree(root-&gt;left);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right) free_tree(root-&gt;right);</span><br><span class="line">    <span class="keyword">delete</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_pre_order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node *tree = get_tree(<span class="number">100000</span>);</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dfs_ret, ret;</span><br><span class="line"></span><br><span class="line">    dfs_pre_order(tree, dfs_ret);</span><br><span class="line">    pre_order(tree, ret);</span><br><span class="line">    assert(dfs_ret == ret);</span><br><span class="line"></span><br><span class="line">    free_tree(tree);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_in_order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node *tree = get_tree(<span class="number">100000</span>);</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dfs_ret, ret;</span><br><span class="line"></span><br><span class="line">    dfs_in_order(tree, dfs_ret);</span><br><span class="line">    in_order(tree, ret);</span><br><span class="line">    assert(dfs_ret == ret);</span><br><span class="line"></span><br><span class="line">    free_tree(tree);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_post_order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node *tree = get_tree(<span class="number">100000</span>);</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dfs_ret, ret;</span><br><span class="line"></span><br><span class="line">    dfs_post_order(tree, dfs_ret);</span><br><span class="line">    post_order(tree, ret);</span><br><span class="line">    assert(dfs_ret == ret);</span><br><span class="line"></span><br><span class="line">    free_tree(tree);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    test_pre_order();</span><br><span class="line">    test_in_order();</span><br><span class="line">    test_post_order();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/29/Median-of-Two-Sorted-Arrays/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/Median-of-Two-Sorted-Arrays/" class="post-title-link" itemprop="url">Median of Two Sorted Arrays</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-29 15:01:00 15:01:00" itemprop="dateCreated datePublished" datetime="2019-12-29T15:01:00+08:00">2019-12-29 15:01:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/29/Median-of-Two-Sorted-Arrays/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/29/Median-of-Two-Sorted-Arrays/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>https://leetcode.com/problems/median-of-two-sorted-arrays/</p>
<p><span class="math inline">\(kth\)</span><span class="math inline">\(k\)</span><span class="math inline">\(A\)</span><span class="math inline">\(B\)</span><span class="math inline">\(p\)</span><span class="math inline">\(p\)</span><span class="math inline">\(k\)</span><span class="math inline">\(p\)</span><span class="math inline">\(A\)</span><span class="math inline">\(B\)</span><span class="math inline">\(A\)</span><span class="math inline">\(B\)</span><span class="math inline">\(k-p\)</span> <span class="math inline">\(k=1\)</span> <span class="math inline">\(p \in [1, \lfloor \frac{k}{2} \rfloor]\)</span><span class="math inline">\(A[0:p]\)</span><span class="math inline">\(B[0:p]\)</span><span class="math inline">\(A_p\)</span><span class="math inline">\(B_p\)</span><span class="math inline">\(A_p &lt; B_p\)</span><span class="math inline">\(A\)</span><span class="math inline">\(p\)</span><span class="math inline">\(k\)</span><span class="math inline">\(B\)</span><span class="math inline">\(p\)</span><span class="math inline">\(k\)</span></p>
<p><span class="math inline">\(p\)</span><span class="math inline">\(\lfloor \frac{k}{2} \rfloor\)</span><span class="math inline">\(O(log(k)) = O(log(n + m))\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums1.size() + nums2.size();</span><br><span class="line">        <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> kth(nums1, <span class="number">0</span>, nums2, <span class="number">0</span>, n / <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> (kth(nums1, <span class="number">0</span>, nums2, <span class="number">0</span>, n / <span class="number">2</span>) + kth(nums1, <span class="number">0</span>, nums2, <span class="number">0</span>, n / <span class="number">2</span> + <span class="number">1</span>)) / <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums1, <span class="keyword">int</span> n1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums2, <span class="keyword">int</span> n2, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums1.size() - n1 &gt; nums2.size() - n2)</span><br><span class="line">            <span class="keyword">return</span> kth(nums2, n2, nums1, n1, k);</span><br><span class="line">        <span class="keyword">if</span> (nums1.size() - n1 == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> nums2[n2 + k - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> min(nums1[n1], nums2[n2]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> p = min(k / <span class="number">2</span>, <span class="keyword">int</span>(nums1.size() - n1));</span><br><span class="line">        <span class="keyword">if</span> (nums1[n1 + p - <span class="number">1</span>] &lt; nums2[n2 + p - <span class="number">1</span>])</span><br><span class="line">            <span class="keyword">return</span> kth(nums1, n1 + p, nums2, n2, k - p);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> kth(nums1, n1, nums2, n2 + p, k - p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/24/wait%E5%92%8Csignal%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/24/wait%E5%92%8Csignal%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">waitsignal</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-24 11:33:00 11:33:00" itemprop="dateCreated datePublished" datetime="2019-12-24T11:33:00+08:00">2019-12-24 11:33:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/24/wait%E5%92%8Csignal%E6%B5%8B%E8%AF%95/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/24/waitsignal/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -ra</span><br><span class="line">Linux Rapture 4.15.0-72-generic #81~16.04.1-Ubuntu SMP Tue Nov 26 16:34:21 UTC 2019 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure>
<p><code>signal.cpp</code> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;signal num: %d\n&quot;</span>, num);</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sleep over\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; argc;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--handle&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            signal(atoi(argv[i + <span class="number">1</span>]), handle);</span><br><span class="line">            i += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pid: %d\n&quot;</span>, getpid());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, time(<span class="literal">NULL</span>));</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;signal &amp;</span><br><span class="line">[1] 6223</span><br><span class="line">pid: 6223</span><br><span class="line">1577155844</span><br><span class="line">1577155845</span><br><span class="line">$ kill -KILL 6223</span><br><span class="line">[1]  + 6223 killed     .&#x2F;signal</span><br><span class="line"></span><br><span class="line">$ .&#x2F;signal --handle 9 &amp;</span><br><span class="line">[1] 6261</span><br><span class="line">pid: 6261</span><br><span class="line">1577155864</span><br><span class="line">1577155865</span><br><span class="line">$ kill -KILL 6261</span><br><span class="line">[1]  + 6261 killed     .&#x2F;signal --handle 9</span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;signal &amp;</span><br><span class="line">[1] 6471</span><br><span class="line">pid: 6471</span><br><span class="line">1577156088</span><br><span class="line">1577156089</span><br><span class="line">$ kill -SIGSTOP 6471</span><br><span class="line">[1]  + 6471 suspended (signal)  .&#x2F;signal</span><br><span class="line">......</span><br><span class="line">$ kill -SIGCONT 6471</span><br><span class="line">1577156113</span><br><span class="line">1577156114</span><br><span class="line">1577156115</span><br><span class="line">1577156116</span><br><span class="line">1577156117</span><br><span class="line"></span><br><span class="line">$ .&#x2F;signal --handle 18 19 &amp;</span><br><span class="line">[1] 6566</span><br><span class="line">pid: 6566</span><br><span class="line">1577156249</span><br><span class="line">1577156250</span><br><span class="line">$ kill -SIGSTOP 6566</span><br><span class="line">[1]  + 6566 suspended (signal)  .&#x2F;signal --handle 18 19</span><br><span class="line">......</span><br><span class="line">$ kill -SIGCONT 6566</span><br><span class="line">signal num: 18</span><br><span class="line">sleep over</span><br><span class="line">1577156270</span><br><span class="line">1577156271</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;signal --handle 15 &amp;</span><br><span class="line">[1] 7148</span><br><span class="line">pid: 7148</span><br><span class="line">1577156583</span><br><span class="line">1577156584</span><br><span class="line">1577156585</span><br><span class="line">$ kill -SIGTERM 7148</span><br><span class="line">$ kill -SIGTERM 7148</span><br><span class="line">$ kill -SIGTERM 7148</span><br><span class="line">$ kill -SIGTERM 7148</span><br><span class="line">$ kill -SIGTERM 7148</span><br><span class="line">signal num: 15</span><br><span class="line">sleep over</span><br><span class="line">signal num: 15</span><br><span class="line">sleep over</span><br><span class="line">1577156597</span><br><span class="line">1577156598</span><br><span class="line">1577156599</span><br><span class="line">1577156600</span><br><span class="line">1577156601</span><br><span class="line">......</span><br><span class="line">$ kill -KILL 7148</span><br><span class="line">[1]  + 7148 killed     .&#x2F;signal --handle 15</span><br></pre></td></tr></table></figure>
<p><code>wait.cpp</code> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;signal num: %d\n&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> options = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">bool</span> divide_zero = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">bool</span> invalid_memory = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; argc;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--WUNTRACED&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            options |= WUNTRACED;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--WNOHANG&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            options |= WNOHANG;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--WCONTINUED&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            options |= WCONTINUED;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--handle&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            signal(atoi(argv[i + <span class="number">1</span>]), handle);</span><br><span class="line">            i += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--divide-zero&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            divide_zero = <span class="literal">true</span>;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--invalid-memory&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            invalid_memory = <span class="literal">true</span>;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pid_t</span> cpid, w;</span><br><span class="line">    <span class="keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">    cpid = fork();</span><br><span class="line">    <span class="keyword">if</span> (cpid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;fork failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cpid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Child PID is %ld\n&quot;</span>, (<span class="keyword">long</span>) getpid());</span><br><span class="line">        <span class="keyword">if</span> (divide_zero) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = <span class="number">1337</span>;</span><br><span class="line">            <span class="keyword">int</span> y = x / <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (invalid_memory) &#123;</span><br><span class="line">            *(<span class="keyword">int</span> *) <span class="number">0</span> = <span class="number">1337</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;time: %d\n&quot;</span>, time(<span class="literal">NULL</span>));</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Father PID is %ld\n&quot;</span>, (<span class="keyword">long</span>) getpid());</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            w = waitpid(cpid, &amp;status, options);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;w: %d, WIFEXITED: %d, WIFSIGNALED: %d, WIFSTOPPED: %d, WIFCONTINUED: %d\n&quot;</span>,</span><br><span class="line">                   w, WIFEXITED(status), WIFSIGNALED(status), WIFSTOPPED(status), WIFCONTINUED(status));</span><br><span class="line">            <span class="keyword">if</span> (w == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (w == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;waitpid error\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (WIFEXITED(status)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;exited, status=%d\n&quot;</span>, WEXITSTATUS(status));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (WIFSIGNALED(status)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;killed by signal %d\n&quot;</span>, WTERMSIG(status));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (WIFSTOPPED(status)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;stopped by signal %d\n&quot;</span>, WSTOPSIG(status));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (WIFCONTINUED(status)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;continued\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> ((!WIFEXITED(status) &amp;&amp; !WIFSIGNALED(status)) || w == <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;wait &amp;</span><br><span class="line">[1] 7523</span><br><span class="line">Father PID is 7523</span><br><span class="line">Child PID is 7525</span><br><span class="line">time: 1577156913</span><br><span class="line">time: 1577156914</span><br><span class="line">time: 1577156915</span><br><span class="line">time: 1577156916</span><br><span class="line">$ kill 7525</span><br><span class="line">w: 7525, WIFEXITED: 0, WIFSIGNALED: 1, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">killed by signal 15</span><br><span class="line"></span><br><span class="line">$ .&#x2F;wait --handle 15</span><br><span class="line">Father PID is 7566</span><br><span class="line">Child PID is 7567</span><br><span class="line">time: 1577156938</span><br><span class="line">time: 1577156939</span><br><span class="line">time: 1577156940</span><br><span class="line">time: 1577156941</span><br><span class="line">$ kill 7567</span><br><span class="line">signal num: 15</span><br><span class="line">time: 1577156941</span><br><span class="line">time: 1577156942</span><br><span class="line">$ kill -KILL 7567</span><br><span class="line">w: 7567, WIFEXITED: 0, WIFSIGNALED: 1, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">killed by signal 9</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;wait --divide-zero</span><br><span class="line">Child PID is 7744</span><br><span class="line">Father PID is 7743</span><br><span class="line">w: 7744, WIFEXITED: 0, WIFSIGNALED: 1, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">killed by signal 8</span><br><span class="line"></span><br><span class="line">$ .&#x2F;wait --divide-zero --handle 8</span><br><span class="line">Father PID is 7716</span><br><span class="line">Child PID is 7717</span><br><span class="line">signal num: 8</span><br><span class="line">signal num: 8</span><br><span class="line">signal num: 8</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;wait --invalid-memory</span><br><span class="line">Father PID is 8085</span><br><span class="line">Child PID is 8086</span><br><span class="line">w: 8086, WIFEXITED: 0, WIFSIGNALED: 1, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">killed by signal 11</span><br><span class="line"></span><br><span class="line">$ .&#x2F;wait --invalid-memory --handle 11</span><br><span class="line">Father PID is 8432</span><br><span class="line">Child PID is 8433</span><br><span class="line">signal num: 11</span><br><span class="line">signal num: 11</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;wait --WNOHANG &amp;</span><br><span class="line">Father PID is 9033</span><br><span class="line">Child PID is 9034</span><br><span class="line">w: 0, WIFEXITED: 1, WIFSIGNALED: 0, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">w: 0, WIFEXITED: 1, WIFSIGNALED: 0, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">time: 1577157886</span><br><span class="line">time: 1577157887</span><br><span class="line">......</span><br><span class="line">$ kill 9034</span><br><span class="line">w: 9034, WIFEXITED: 0, WIFSIGNALED: 1, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">killed by signal 15</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;wait --WUNTRACED --WCONTINUED --handle 15 &amp;</span><br><span class="line">[1] 9312</span><br><span class="line">Child PID is 9314</span><br><span class="line">time: 1577158011</span><br><span class="line">Father PID is 9312</span><br><span class="line">time: 1577158013</span><br><span class="line">time: 1577158014</span><br><span class="line">$ kill 9314</span><br><span class="line">signal num: 15</span><br><span class="line">time: 1577158015</span><br><span class="line">time: 1577158016</span><br><span class="line">......</span><br><span class="line">time: 1577158025</span><br><span class="line">time: 1577158026</span><br><span class="line">time: 1577158027</span><br><span class="line">time: 1577158028</span><br><span class="line">$ kill -SIGSTOP 9314</span><br><span class="line">w: 9314, WIFEXITED: 0, WIFSIGNALED: 0, WIFSTOPPED: 1, WIFCONTINUED: 0</span><br><span class="line">stopped by signal 19</span><br><span class="line">$ kill -SIGCONT 9314</span><br><span class="line">w: 9314, WIFEXITED: 0, WIFSIGNALED: 0, WIFSTOPPED: 0, WIFCONTINUED: 1</span><br><span class="line">continued</span><br><span class="line">time: 1577158038</span><br><span class="line">...</span><br><span class="line">time: 1577158041</span><br><span class="line">$ kill -SIGKILL 9314</span><br><span class="line">w: 9314, WIFEXITED: 0, WIFSIGNALED: 1, WIFSTOPPED: 0, WIFCONTINUED: 0</span><br><span class="line">killed by signal 9</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/17/NSQ%E5%AD%A6%E4%B9%A0-%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/17/NSQ%E5%AD%A6%E4%B9%A0-%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86/" class="post-title-link" itemprop="url">NSQ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-17 16:27:00 16:27:00" itemprop="dateCreated datePublished" datetime="2019-12-17T16:27:00+08:00">2019-12-17 16:27:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/17/NSQ%E5%AD%A6%E4%B9%A0-%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/17/NSQ-/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nsqdnsqlookupd">NSQDNSQLookupd</h1>
<p><code>NSQLookupd</code><code>NSQLookupd</code><code>Topic</code><code>NSQD</code><code>NSQD</code> <code>NSQD</code><code>Topic</code><code>Channle</code><code>NSQD</code><code>NSQLookupd</code></p>
<h1 id=""></h1>
<p><code>NSQD</code><code>Topic</code><code>Topic.messagePump</code><code>Topic</code><code>Channel</code></p>
<p><code>nsq/nsqd/protocol_v2.go</code><code>protocolV2.IOLoop</code><code>Channel</code><code>protocolV2.messagePump</code><code>REQ</code><code>FIN</code> push<code>InFlightQueue</code> <code>InFlightQueue</code> <code>FIN</code><code>NSQD</code><code>NSQD</code><code>Channel</code><code>InFlightQueue</code> <code>FIN</code><code>InFlightQueue</code><code>Channel</code> <code>REQ</code><code>InFlightQueue</code><code>DeferredQueue</code><code>Channel</code> <code>DeferredQueue</code></p>
<p><img src="/images/posts/NSQ-/0.png" /></p>
<h1 id=""></h1>
<h2 id="deferredqueueinflightqueue">DeferredQueueInFlightQueue</h2>
<p><code>NSQD</code><code>Metadata</code><code>Topic</code><code>Channel</code><code>Topic</code><code>Channel</code></p>
<p><code>NSQD</code><code>Channel</code><code>memoryMsgChan</code><code>inFlightMessages</code><code>deferredMessages</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/15/%E8%8E%B7%E5%8F%96CPU%E6%97%B6%E9%97%B4%E5%92%8C%E8%AE%A1%E7%AE%97CPU%E4%BD%BF%E7%94%A8%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/15/%E8%8E%B7%E5%8F%96CPU%E6%97%B6%E9%97%B4%E5%92%8C%E8%AE%A1%E7%AE%97CPU%E4%BD%BF%E7%94%A8%E7%8E%87/" class="post-title-link" itemprop="url">CPUCPU</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-15 14:48:00 14:48:00" itemprop="dateCreated datePublished" datetime="2019-12-15T14:48:00+08:00">2019-12-15 14:48:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/15/%E8%8E%B7%E5%8F%96CPU%E6%97%B6%E9%97%B4%E5%92%8C%E8%AE%A1%E7%AE%97CPU%E4%BD%BF%E7%94%A8%E7%8E%87/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/15/CPUCPU/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/resource.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DBG(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cpu_load</span><span class="params">(<span class="keyword">double</span> start, <span class="keyword">double</span> end, <span class="keyword">double</span> used)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> used / (end - start) * <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cpu_time_used_s</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rusage usage;</span><br><span class="line">    getrusage(RUSAGE_SELF, &amp;usage);</span><br><span class="line">    <span class="keyword">return</span> usage.ru_stime.tv_sec + <span class="keyword">double</span>(usage.ru_stime.tv_usec) / <span class="number">1000000</span> + usage.ru_utime.tv_sec + <span class="keyword">double</span>(usage.ru_utime.tv_usec) / <span class="number">1000000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">get_time_s</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    timeval tv;</span><br><span class="line">    gettimeofday(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> tv.tv_sec + <span class="keyword">double</span>(tv.tv_usec) / <span class="number">1000000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> start = get_time_s();</span><br><span class="line"></span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">int</span> x = rand();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">300000000</span>; i++) &#123;</span><br><span class="line">        x ^= rand();</span><br><span class="line">        x |= rand();</span><br><span class="line">        x &amp;= ~rand();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> end = get_time_s();</span><br><span class="line">    <span class="keyword">double</span> real_time_used = end - start;</span><br><span class="line">    <span class="keyword">double</span> cpu_time_used = cpu_time_used_s();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;start: %.3fs, end: %.3fs\n&quot;</span></span><br><span class="line">           <span class="string">&quot;real_time_used: %.3f\n&quot;</span></span><br><span class="line">           <span class="string">&quot;cpu_time_used: %.3fs, cpu_load: %.3f%%\n&quot;</span>,</span><br><span class="line">           start, end, real_time_used, cpu_time_used, cpu_load(start, end, cpu_time_used));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start: 1576392425.566s, end: 1576392438.229s</span><br><span class="line">real_time_used: 12.663</span><br><span class="line">cpu_time_used: 6.230s, cpu_load: 49.201%</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/15/Redis%E5%AD%A6%E4%B9%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/15/Redis%E5%AD%A6%E4%B9%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">Redis </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-15 13:34:00 13:34:00" itemprop="dateCreated datePublished" datetime="2019-12-15T13:34:00+08:00">2019-12-15 13:34:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/15/Redis%E5%AD%A6%E4%B9%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/15/Redis-/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://github.com/antirez/redis/tree/3.0">Redis3.0</a>Redis</p>
<h1 id=""></h1>
<p>Redis<code>String</code><code>List</code><code>Set</code><code>Hash</code><code>Sorted Set</code>Redis<code>redisObject</code><code>type</code><code>encoding</code><code>ptr</code> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Object types */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_STRING 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_LIST 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_SET 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ZSET 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_HASH 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Objects encoding. Some kind of objects like Strings and Hashes can be</span></span><br><span class="line"><span class="comment"> * internally represented in multiple ways. The &#x27;encoding&#x27; field of the object</span></span><br><span class="line"><span class="comment"> * is set to one of this fields for this object. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_RAW 0     <span class="comment">/* Raw representation */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_INT 1     <span class="comment">/* Encoded as integer */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_HT 2      <span class="comment">/* Encoded as hash table */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_ZIPMAP 3  <span class="comment">/* Encoded as zipmap */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_LINKEDLIST 4 <span class="comment">/* Encoded as regular linked list */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_ZIPLIST 5 <span class="comment">/* Encoded as ziplist */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_INTSET 6  <span class="comment">/* Encoded as intset */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_SKIPLIST 7  <span class="comment">/* Encoded as skiplist */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REDIS_ENCODING_EMBSTR 8  <span class="comment">/* Embedded sds string encoding */</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">redisObject</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> type:<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> encoding:<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> lru:REDIS_LRU_BITS; <span class="comment">/* lru time (relative to server.lruclock) */</span></span><br><span class="line">    <span class="keyword">int</span> refcount;</span><br><span class="line">    <span class="keyword">void</span> *ptr;</span><br><span class="line">&#125; robj;</span><br></pre></td></tr></table></figure></p>
<h1 id=""></h1>
<h2 id="sds---simple-dynamic-string">SDS - Simple Dynamic String</h2>
<p>SDS</p>
<h3 id=""></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span> *sds;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sdshdr</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">free</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="api">API</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Append the specified binary-safe string pointed by &#x27;t&#x27; of &#x27;len&#x27; bytes to the</span></span><br><span class="line"><span class="comment"> * end of the specified sds string &#x27;s&#x27;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * After the call, the passed sds string is no longer valid and all the</span></span><br><span class="line"><span class="comment"> * references must be substituted with the new pointer returned by the call. */</span></span><br><span class="line"><span class="function">sds <span class="title">sdscatlen</span><span class="params">(sds s, <span class="keyword">const</span> <span class="keyword">void</span> *t, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sdshdr</span> *<span class="title">sh</span>;</span></span><br><span class="line">    <span class="keyword">size_t</span> curlen = sdslen(s);</span><br><span class="line"></span><br><span class="line">    s = sdsMakeRoomFor(s,len);</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    sh = (<span class="keyword">void</span>*) (s-(<span class="keyword">sizeof</span>(struct sdshdr)));</span><br><span class="line">    <span class="built_in">memcpy</span>(s+curlen, t, len);</span><br><span class="line">    sh-&gt;len = curlen+len;</span><br><span class="line">    sh-&gt;<span class="built_in">free</span> = sh-&gt;<span class="built_in">free</span>-len;</span><br><span class="line">    s[curlen+len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Append the specified null termianted C string to the sds string &#x27;s&#x27;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * After the call, the passed sds string is no longer valid and all the</span></span><br><span class="line"><span class="comment"> * references must be substituted with the new pointer returned by the call. */</span></span><br><span class="line"><span class="function">sds <span class="title">sdscat</span><span class="params">(sds s, <span class="keyword">const</span> <span class="keyword">char</span> *t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sdscatlen(s, t, <span class="built_in">strlen</span>(t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="list">List</h2>
<p> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Node, List, and Iterator are the only data structures used currently. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">prev</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="keyword">void</span> *value;</span><br><span class="line">&#125; listNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">listIter</span> &#123;</span></span><br><span class="line">    listNode *next;</span><br><span class="line">    <span class="keyword">int</span> direction;</span><br><span class="line">&#125; listIter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">list</span> &#123;</span></span><br><span class="line">    listNode *head;</span><br><span class="line">    listNode *tail;</span><br><span class="line">    <span class="keyword">void</span> *(*dup)(<span class="keyword">void</span> *ptr);</span><br><span class="line">    <span class="keyword">void</span> (*<span class="built_in">free</span>)(<span class="keyword">void</span> *ptr);</span><br><span class="line">    <span class="keyword">int</span> (*match)(<span class="keyword">void</span> *ptr, <span class="keyword">void</span> *key);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> len;</span><br><span class="line">&#125; <span class="built_in">list</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Functions implemented as macros */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listLength(l) ((l)-&gt;len)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listFirst(l) ((l)-&gt;head)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listLast(l) ((l)-&gt;tail)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listPrevNode(n) ((n)-&gt;prev)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listNextNode(n) ((n)-&gt;next)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listNodeValue(n) ((n)-&gt;value)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listSetDupMethod(l,m) ((l)-&gt;dup = (m))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listSetFreeMethod(l,m) ((l)-&gt;free = (m))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listSetMatchMethod(l,m) ((l)-&gt;match = (m))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listGetDupMethod(l) ((l)-&gt;dup)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listGetFree(l) ((l)-&gt;free)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> listGetMatchMethod(l) ((l)-&gt;match)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Prototypes */</span></span><br><span class="line"><span class="function"><span class="built_in">list</span> *<span class="title">listCreate</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">listRelease</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">list</span> *<span class="title">listAddNodeHead</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, <span class="keyword">void</span> *value)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">list</span> *<span class="title">listAddNodeTail</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, <span class="keyword">void</span> *value)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">list</span> *<span class="title">listInsertNode</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, listNode *old_node, <span class="keyword">void</span> *value, <span class="keyword">int</span> after)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">listDelNode</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, listNode *node)</span></span>;</span><br><span class="line"><span class="function">listIter *<span class="title">listGetIterator</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, <span class="keyword">int</span> direction)</span></span>;</span><br><span class="line"><span class="function">listNode *<span class="title">listNext</span><span class="params">(listIter *iter)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">listReleaseIterator</span><span class="params">(listIter *iter)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">list</span> *<span class="title">listDup</span><span class="params">(<span class="built_in">list</span> *orig)</span></span>;</span><br><span class="line"><span class="function">listNode *<span class="title">listSearchKey</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, <span class="keyword">void</span> *key)</span></span>;</span><br><span class="line"><span class="function">listNode *<span class="title">listIndex</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, <span class="keyword">long</span> index)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">listRewind</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, listIter *li)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">listRewindTail</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>, listIter *li)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">listRotate</span><span class="params">(<span class="built_in">list</span> *<span class="built_in">list</span>)</span></span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="dict">Dict</h2>
<p>DictSeparate Chaining Hash Table USED/BUCKETS</p>
<h3 id="-1"></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span> *key;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *val;</span><br><span class="line">        <span class="keyword">uint64_t</span> u64;</span><br><span class="line">        <span class="keyword">int64_t</span> s64;</span><br><span class="line">        <span class="keyword">double</span> d;</span><br><span class="line">    &#125; v;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; dictEntry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictType</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">unsigned</span> <span class="title">int</span> <span class="params">(*hashFunction)</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *key)</span></span>;</span><br><span class="line">    <span class="keyword">void</span> *(*keyDup)(<span class="keyword">void</span> *privdata, <span class="keyword">const</span> <span class="keyword">void</span> *key);</span><br><span class="line">    <span class="keyword">void</span> *(*valDup)(<span class="keyword">void</span> *privdata, <span class="keyword">const</span> <span class="keyword">void</span> *obj);</span><br><span class="line">    <span class="keyword">int</span> (*keyCompare)(<span class="keyword">void</span> *privdata, <span class="keyword">const</span> <span class="keyword">void</span> *key1, <span class="keyword">const</span> <span class="keyword">void</span> *key2);</span><br><span class="line">    <span class="keyword">void</span> (*keyDestructor)(<span class="keyword">void</span> *privdata, <span class="keyword">void</span> *key);</span><br><span class="line">    <span class="keyword">void</span> (*valDestructor)(<span class="keyword">void</span> *privdata, <span class="keyword">void</span> *obj);</span><br><span class="line">&#125; dictType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* This is our hash table structure. Every dictionary has two of this as we</span></span><br><span class="line"><span class="comment"> * implement incremental rehashing, for the old to the new table. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictht</span> &#123;</span></span><br><span class="line">    dictEntry **table;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> size;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> sizemask;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> used;</span><br><span class="line">&#125; dictht;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dict</span> &#123;</span></span><br><span class="line">    dictType *type;</span><br><span class="line">    <span class="keyword">void</span> *privdata;</span><br><span class="line">    dictht ht[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">long</span> rehashidx; <span class="comment">/* rehashing not in progress if rehashidx == -1 */</span></span><br><span class="line">    <span class="keyword">int</span> iterators; <span class="comment">/* number of iterators currently running */</span></span><br><span class="line">&#125; dict;</span><br></pre></td></tr></table></figure>
<h3 id=""></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Add an element to the target hash table */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dictAdd</span><span class="params">(dict *d, <span class="keyword">void</span> *key, <span class="keyword">void</span> *val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dictEntry *entry = dictAddRaw(d,key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!entry) <span class="keyword">return</span> DICT_ERR;</span><br><span class="line">    dictSetVal(d, entry, val);</span><br><span class="line">    <span class="keyword">return</span> DICT_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Low level add. This function adds the entry but instead of setting</span></span><br><span class="line"><span class="comment"> * a value returns the dictEntry structure to the user, that will make</span></span><br><span class="line"><span class="comment"> * sure to fill the value field as he wishes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function is also directly exposed to the user API to be called</span></span><br><span class="line"><span class="comment"> * mainly in order to store non-pointers inside the hash value, example:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * entry = dictAddRaw(dict,mykey);</span></span><br><span class="line"><span class="comment"> * if (entry != NULL) dictSetSignedIntegerVal(entry,1000);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return values:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If key already exists NULL is returned.</span></span><br><span class="line"><span class="comment"> * If key was added, the hash entry is returned to be manipulated by the caller.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">dictEntry *<span class="title">dictAddRaw</span><span class="params">(dict *d, <span class="keyword">void</span> *key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    dictEntry *entry;</span><br><span class="line">    dictht *ht;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dictIsRehashing(d)) _dictRehashStep(d);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Get the index of the new element, or -1 if</span></span><br><span class="line"><span class="comment">     * the element already exists. */</span></span><br><span class="line">    <span class="keyword">if</span> ((index = _dictKeyIndex(d, key)) == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Allocate the memory and store the new entry */</span></span><br><span class="line">    ht = dictIsRehashing(d) ? &amp;d-&gt;ht[<span class="number">1</span>] : &amp;d-&gt;ht[<span class="number">0</span>];</span><br><span class="line">    entry = zmalloc(<span class="keyword">sizeof</span>(*entry));</span><br><span class="line">    entry-&gt;next = ht-&gt;table[index];</span><br><span class="line">    ht-&gt;table[index] = entry;</span><br><span class="line">    ht-&gt;used++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Set the hash entry fields. */</span></span><br><span class="line">    dictSetKey(d, entry, key);</span><br><span class="line">    <span class="keyword">return</span> entry;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">dictEntry *<span class="title">dictFind</span><span class="params">(dict *d, <span class="keyword">const</span> <span class="keyword">void</span> *key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dictEntry *he;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> h, idx, table;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (d-&gt;ht[<span class="number">0</span>].size == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">/* We don&#x27;t have a table at all */</span></span><br><span class="line">    <span class="keyword">if</span> (dictIsRehashing(d)) _dictRehashStep(d);</span><br><span class="line">    h = dictHashKey(d, key);</span><br><span class="line">    <span class="keyword">for</span> (table = <span class="number">0</span>; table &lt;= <span class="number">1</span>; table++) &#123;</span><br><span class="line">        idx = h &amp; d-&gt;ht[table].sizemask;</span><br><span class="line">        he = d-&gt;ht[table].table[idx];</span><br><span class="line">        <span class="keyword">while</span>(he) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dictCompareKeys(d, key, he-&gt;key))</span><br><span class="line">                <span class="keyword">return</span> he;</span><br><span class="line">            he = he-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!dictIsRehashing(d)) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="skiplist">Skiplist</h2>
<p> O(logN)O(N)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ZSETs use a specialized version of Skiplists */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    robj *obj;</span><br><span class="line">    <span class="keyword">double</span> score;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> span;</span><br><span class="line">    &#125; level[];</span><br><span class="line">&#125; zskiplistNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> length;</span><br><span class="line">    <span class="keyword">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br><span class="line"></span><br><span class="line"><span class="function">zskiplist *<span class="title">zslCreate</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">zslFree</span><span class="params">(zskiplist *zsl)</span></span>;</span><br><span class="line"><span class="function">zskiplistNode *<span class="title">zslInsert</span><span class="params">(zskiplist *zsl, <span class="keyword">double</span> score, robj *obj)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">zslDelete</span><span class="params">(zskiplist *zsl, <span class="keyword">double</span> score, robj *obj)</span></span>;</span><br><span class="line"><span class="function">zskiplistNode *<span class="title">zslFirstInRange</span><span class="params">(zskiplist *zsl, zrangespec *range)</span></span>;</span><br><span class="line"><span class="function">zskiplistNode *<span class="title">zslLastInRange</span><span class="params">(zskiplist *zsl, zrangespec *range)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">zsetLength</span><span class="params">(robj *zobj)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">zsetConvert</span><span class="params">(robj *zobj, <span class="keyword">int</span> encoding)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">zslGetRank</span><span class="params">(zskiplist *zsl, <span class="keyword">double</span> score, robj *o)</span></span>;</span><br></pre></td></tr></table></figure>
<p><img src="/images/posts/Redis-/0.png" /></p>
<p></p>
<ol type="1">
<li></li>
<li>level</li>
<li></li>
</ol>
<p></p>
<ol type="1">
<li></li>
<li></li>
<li>level</li>
</ol>
<p> <a target="_blank" rel="noopener" href="https://www.spoj.com/problems/ORDERSET/">SPOJ ORDERSET</a></p>
<h2 id=""></h2>
<p>ZiplistIntset</p>
<h1 id=""></h1>
<p>Redis<code>encoding</code>RedisRedis</p>
<p></p>
<table>
<thead>
<tr class="header">
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>REDIS_STRING</td>
<td>REDIS_ENCODING_INT</td>
<td></td>
</tr>
<tr class="even">
<td>REDIS_STRING</td>
<td>REDIS_ENCODING_EMBSTR</td>
<td> embstr </td>
</tr>
<tr class="odd">
<td>REDIS_STRING</td>
<td>REDIS_ENCODING_RAW</td>
<td></td>
</tr>
<tr class="even">
<td>REDIS_LIST</td>
<td>REDIS_ENCODING_ZIPLIST</td>
<td></td>
</tr>
<tr class="odd">
<td>REDIS_LIST</td>
<td>REDIS_ENCODING_LINKEDLIST</td>
<td></td>
</tr>
<tr class="even">
<td>REDIS_HASH</td>
<td>REDIS_ENCODING_ZIPLIST</td>
<td></td>
</tr>
<tr class="odd">
<td>REDIS_HASH</td>
<td>REDIS_ENCODING_HT</td>
<td></td>
</tr>
<tr class="even">
<td>REDIS_SET</td>
<td>REDIS_ENCODING_INTSET</td>
<td></td>
</tr>
<tr class="odd">
<td>REDIS_SET</td>
<td>REDIS_ENCODING_HT</td>
<td></td>
</tr>
<tr class="even">
<td>REDIS_ZSET</td>
<td>REDIS_ENCODING_ZIPLIST</td>
<td></td>
</tr>
<tr class="odd">
<td>REDIS_ZSET</td>
<td>REDIS_ENCODING_SKIPLIST</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="set">Set</h2>
<p>Set<code>intset</code><code>hashtable</code> <code>hashtable</code>NULL</p>
<h2 id="sorted-set">Sorted Set</h2>
<p>https://news.ycombinator.com/item?id=1171423 Sorted Set<code>ziplist</code><code>skiplist</code> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    dict *dict;</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure> <code>skiplist</code><code>redisObject.ptr</code><code>zset</code> skiplistkeyvaluezsetdict</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ToRapture"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">ToRapture</p>
  <div class="site-description" itemprop="description">Some notes</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ToRapture" title="GitHub  https:&#x2F;&#x2F;github.com&#x2F;ToRapture" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/ToRapture" title="Twitter  https:&#x2F;&#x2F;twitter.com&#x2F;ToRapture" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:torapture@gmail.com" title="E-Mail  mailto:torapture@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ToRapture</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://torapture.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
