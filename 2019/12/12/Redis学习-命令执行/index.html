<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"torapture.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="协议格式  The way RESP is used in Redis as a request-response protocol is the following: * Clients send commands to a Redis server as a RESP Array of Bulk Strings. * The server replies with one of the R">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis学习 命令执行">
<meta property="og:url" content="https://torapture.github.io/2019/12/12/Redis%E5%AD%A6%E4%B9%A0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/index.html">
<meta property="og:site_name" content="ToRapture&#39;s Blog">
<meta property="og:description" content="协议格式  The way RESP is used in Redis as a request-response protocol is the following: * Clients send commands to a Redis server as a RESP Array of Bulk Strings. * The server replies with one of the R">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://torapture.github.io/images/posts/Redis学习-命令执行/0.jpg">
<meta property="og:image" content="https://torapture.github.io/images/posts/Redis学习-命令执行/1.jpg">
<meta property="og:image" content="https://torapture.github.io/images/posts/Redis学习-命令执行/2.jpg">
<meta property="og:image" content="https://torapture.github.io/images/posts/Redis学习-命令执行/3.png">
<meta property="og:image" content="https://torapture.github.io/images/posts/Redis学习-命令执行/4.png">
<meta property="article:published_time" content="2019-12-12T10:13:00.000Z">
<meta property="article:modified_time" content="2020-10-11T14:07:40.683Z">
<meta property="article:author" content="ToRapture">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://torapture.github.io/images/posts/Redis学习-命令执行/0.jpg">

<link rel="canonical" href="https://torapture.github.io/2019/12/12/Redis%E5%AD%A6%E4%B9%A0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Redis学习 命令执行 | ToRapture's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ToRapture's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">A Programmer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://torapture.github.io/2019/12/12/Redis%E5%AD%A6%E4%B9%A0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ToRapture">
      <meta itemprop="description" content="Some notes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ToRapture's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis学习 命令执行
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-12 18:13:00 18:13:00" itemprop="dateCreated datePublished" datetime="2019-12-12T18:13:00+08:00">2019-12-12 18:13:00</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:07:40 22:07:40" itemprop="dateModified" datetime="2020-10-11T22:07:40+08:00">2020-10-11 22:07:40</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="协议格式">协议格式</h1>
<blockquote>
<p>The way RESP is used in Redis as a request-response protocol is the following: * Clients send commands to a Redis server as a RESP Array of Bulk Strings. * The server replies with one of the RESP types according to the command implementation.</p>
<p>In RESP, the type of some data depends on the first byte: * For <strong>Simple Strings</strong> the first byte of the reply is <code>"+"</code> * For <strong>Errors</strong> the first byte of the reply is <code>"-"</code> * For <strong>Integers</strong> the first byte of the reply is <code>":"</code> * For <strong>Bulk Strings</strong> the first byte of the reply is <code>"$"</code> * For <strong>Arrays</strong> the first byte of the reply is <code>"*"</code></p>
</blockquote>
<p>引用自<a target="_blank" rel="noopener" href="https://redis.io/topics/protocol" class="uri">https://redis.io/topics/protocol</a>。</p>
<hr />
<h1 id="建连与执行命令">建连与执行命令</h1>
<p>Redis服务端通过使用<code>select</code>、<code>poll</code>等I/O多路复用系统调用来实现事件驱动模型。 Redis中的事件分为两类，一类被称为定时事件，如定期执行<code>serverCron</code>来处理过期逻辑、保存RDB、保存AOF等；另一类被称为文件事件，I/O多路复用函数在处理文件事件时使用，当与文件事件相关联的文件描述符ready即可读或可写时，<code>select</code>等函数返回，Redis使用与ready的文件描述符绑定的函数来处理相应的事件。 与文件描述符绑定的函数可分为三类：</p>
<ol type="1">
<li>AcceptHandler，用来<code>accept</code>客户端的连接，并且把<code>accept</code>后得到的文件描述符设置为非阻塞<code>O_NONBLOCK</code></li>
<li>ReadHandler，用来<code>read</code>客户端发过来的数据，并且每当读到一条完整命令后就执行并把结果写到服务端的与该客户端相对应的缓冲区</li>
<li>WriteHandler，用来把服务端的与客户端对应的缓冲区中的数据<code>write</code>给客户端</li>
</ol>
<p><img src="/images/posts/Redis学习-命令执行/0.jpg" /></p>
<h2 id="readhandler">ReadHandler</h2>
<p>实现逻辑参照<code>src/networking.c:readQueryFromClient</code>。 每当<code>fd</code>可读，尝试读<code>REDIS_IOBUF_LEN=1024*16</code>这么多字节的数据到缓冲区，如果<code>nread=0</code>则断开与<code>fd</code>表示的客户端的链接。 当读到的数据不为空时，持续从缓冲区中尝试解析命令并执行，直到缓冲区已经没有完整命令。</p>
<p><img src="/images/posts/Redis学习-命令执行/1.jpg" /></p>
<h2 id="writehandler">WriteHandler</h2>
<p>实现逻辑参照<code>src/networking.c:sendReplyToClient</code>。 每当<code>fd</code>可写，循环把与<code>fd</code>对应的返回结果缓冲区中的全部数据都发给对应的客户端，直到全部发完或该次事件处理的<code>totwritten &gt; REDIS_MAX_WRITE_PER_EVENT=1024*64</code>或<code>write</code>调用出错。 当<code>write</code>调用出错时，若错误<code>EAGAIN</code>为，则下一轮事件循环再尝试写这个<code>fd</code>；若为其他错误，则关闭与<code>fd</code>对应的客户端连接。</p>
<p><img src="/images/posts/Redis学习-命令执行/2.jpg" /></p>
<hr />
<h1 id="pipeline">Pipeline</h1>
<blockquote>
<p>A Request/Response server can be implemented so that it is able to process new requests even if the client didn't already read the old responses. This way it is possible to send multiple commands to the server without waiting for the replies at all, and finally read the replies in a single step.</p>
</blockquote>
<blockquote>
<p>This is called pipelining, and is a technique widely in use since many decades. For instance many POP3 protocol implementations already supported this feature, dramatically speeding up the process of downloading new emails from the server.</p>
</blockquote>
<blockquote>
<p>Redis has supported pipelining since the very early days, so whatever version you are running, you can use pipelining with Redis. This is an example using the raw netcat utility:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ (printf &quot;PING\r\nPING\r\nPING\r\n&quot;; sleep 1) | nc localhost 6379</span><br><span class="line">+PONG</span><br><span class="line">+PONG</span><br><span class="line">+PONG</span><br></pre></td></tr></table></figure>
<p>引用自<a target="_blank" rel="noopener" href="https://redis.io/topics/pipelining#redis-pipelining" class="uri">https://redis.io/topics/pipelining#redis-pipelining</a>。</p>
<p>按照官方文档，所谓pipeline只是客户端一起把多条命令发给服务端，然后一起读返回结果，而不是每发一条命令读一次返回结果。 在Redis服务端代码中并没有对所谓pipeline的特殊处理，服务端也只是每当能解析出一条命令就执行，然后把返回结果写到缓冲区里，然后在下次事件循环时按照<code>WriteHandler</code>中的逻辑把返回结果<code>write</code>给客户端。</p>
<h2 id="命令行实现pipeline调用">命令行实现pipeline调用</h2>
<p>按照官方文档，下面的命令即实现了一次pipeline调用 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ (printf &#39;*2\r\n$3\r\nget\r\n$5\r\nhello\r\n*3\r\n$3\r\nset\r\n$5\r\nhello\r\n$5\r\nworld\r\n*2\r\n$3\r\nget\r\n$5\r\nhello\r\n*3\r\n$3\r\nset\r\n$8\r\n1 plus 1\r\n$1\r\n2\r\n*2\r\n$3\r\nget\r\n$8\r\n1 plus 1\r\n&#39;; sleep 1) | nc localhost 6379</span><br><span class="line">$-1</span><br><span class="line">+OK</span><br><span class="line">$5</span><br><span class="line">world</span><br><span class="line">+OK</span><br><span class="line">$1</span><br><span class="line">2</span><br></pre></td></tr></table></figure> 修改Redis代码加一些日志后，Redis服务端的输出为： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Poll and handle: START</span><br><span class="line">Fd: 5 is readable</span><br><span class="line">13021:M 12 Dec 17:44:44.657 - Accepted 127.0.0.1:57151</span><br><span class="line">Create file event on fd: 6, mask: readable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:44:44.657 - readQueryFromClient fd: 6, nread: 144</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:44:44.658 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:44:45.638 - readQueryFromClient fd: 6, nread: 0</span><br><span class="line">13021:M 12 Dec 17:44:45.638 - Client closed connection</span><br><span class="line">Delete file event on fd: 6, mask: readable</span><br><span class="line">Poll and handle: END</span><br></pre></td></tr></table></figure> Wireshark抓包的结果： <img src="/images/posts/Redis学习-命令执行/3.png" alt="request" /> <img src="/images/posts/Redis学习-命令执行/4.png" alt="response" /></p>
<h2 id="python实现pipeline调用">Python实现pipeline调用</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    client = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line">    pipe = client.pipeline(transaction=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span> * <span class="number">1024</span>):</span><br><span class="line">        pipe.set(i, i)</span><br><span class="line">    pipe.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Redis日志： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">Poll and handle: START</span><br><span class="line">Fd: 5 is readable</span><br><span class="line">13021:M 12 Dec 17:47:02.791 - Accepted 127.0.0.1:57168</span><br><span class="line">Create file event on fd: 6, mask: readable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.001 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.003 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.004 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.004 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.005 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.005 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.006 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.007 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.008 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.008 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.010 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.011 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.011 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.012 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.013 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.013 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.014 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.015 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.016 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.017 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.017 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.018 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.018 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.019 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.019 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.021 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.022 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.022 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.024 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.025 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.025 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.026 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.028 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.028 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.029 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.033 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.033 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.034 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.035 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.035 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.037 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.038 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.038 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.039 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.040 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.040 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.042 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.042 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.042 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.043 - readQueryFromClient fd: 6, nread: 10548</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13021:M 12 Dec 17:47:03.044 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13021:M 12 Dec 17:47:03.108 - readQueryFromClient fd: 6, nread: 0</span><br><span class="line">13021:M 12 Dec 17:47:03.108 - Client closed connection</span><br><span class="line">Delete file event on fd: 6, mask: readable</span><br><span class="line">Poll and handle: END</span><br></pre></td></tr></table></figure></p>
<h2 id="包含大量命令的pipeline">包含大量命令的pipeline</h2>
<p>把上面python代码<code>range</code>的参数改为<code>16 * 1024 * 100</code>，出现了<code>13429:M 12 Dec 18:00:18.557 - sendReplyToClient EAGAIN, fd: 6</code>这种日志。</p>
<hr />
<h1 id="多个客户端同时执行pipeline会发生什么">多个客户端同时执行Pipeline会发生什么</h1>
<p><code>range</code>参数改为<code>16 * 1024 * 10</code>，命令行执行<code>python main.py &amp; python main.py</code>。 Redis日志： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">Poll and handle: START</span><br><span class="line">Fd: 5 is readable</span><br><span class="line">13596:M 12 Dec 18:05:49.267 - Accepted 127.0.0.1:57368</span><br><span class="line">Create file event on fd: 6, mask: readable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 5 is readable</span><br><span class="line">13596:M 12 Dec 18:05:49.269 - Accepted 127.0.0.1:57369</span><br><span class="line">Create file event on fd: 7, mask: readable</span><br><span class="line">Poll and handle: END</span><br><span class="line">13596:M 12 Dec 18:05:53.103 - 2 clients connected (0 slaves), 993008 bytes in use</span><br><span class="line">13596:M 12 Dec 18:05:58.237 - 2 clients connected (0 slaves), 993008 bytes in use</span><br><span class="line">13596:M 12 Dec 18:06:03.371 - 2 clients connected (0 slaves), 993008 bytes in use</span><br><span class="line">13596:M 12 Dec 18:06:08.513 - 2 clients connected (0 slaves), 993008 bytes in use</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.131 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.134 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.134 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.134 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.135 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.136 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">................................</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.283 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 7 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.284 - readQueryFromClient fd: 7, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.285 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.285 - try sendReplyToClient to fd: 7</span><br><span class="line">Delete file event on fd: 7, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.285 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Fd: 7 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.285 - readQueryFromClient fd: 7, nread: 16384</span><br><span class="line">Create file event on fd: 7, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.286 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 7 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.287 - readQueryFromClient fd: 7, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.287 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.287 - try sendReplyToClient to fd: 7</span><br><span class="line">Delete file event on fd: 7, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.288 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Create file event on fd: 6, mask: writeable</span><br><span class="line">Fd: 7 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.288 - readQueryFromClient fd: 7, nread: 16384</span><br><span class="line">Create file event on fd: 7, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.289 - readQueryFromClient fd: 6, nread: 16384</span><br><span class="line">Fd: 7 is readable</span><br><span class="line">13596:M 12 Dec 18:06:09.290 - readQueryFromClient fd: 7, nread: 16384</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.291 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:09.291 - try sendReplyToClient to fd: 7</span><br><span class="line">Delete file event on fd: 7, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">................................</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:19.984 - try sendReplyToClient to fd: 6</span><br><span class="line">13596:M 12 Dec 18:06:19.984 - sendReplyToClient EAGAIN, fd: 6</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:20.121 - try sendReplyToClient to fd: 7</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:20.122 - try sendReplyToClient to fd: 7</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:20.122 - try sendReplyToClient to fd: 7</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:20.122 - try sendReplyToClient to fd: 7</span><br><span class="line">13596:M 12 Dec 18:06:20.122 - sendReplyToClient EAGAIN, fd: 7</span><br><span class="line">Poll and handle: END</span><br><span class="line">................................</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:23.854 - try sendReplyToClient to fd: 7</span><br><span class="line">13596:M 12 Dec 18:06:23.854 - sendReplyToClient EAGAIN, fd: 7</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:24.085 - try sendReplyToClient to fd: 6</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:24.085 - try sendReplyToClient to fd: 6</span><br><span class="line">Delete file event on fd: 6, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:24.192 - try sendReplyToClient to fd: 7</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is writeable</span><br><span class="line">13596:M 12 Dec 18:06:24.192 - try sendReplyToClient to fd: 7</span><br><span class="line">Delete file event on fd: 7, mask: writeable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 6 is readable</span><br><span class="line">13596:M 12 Dec 18:06:26.373 - readQueryFromClient fd: 6, nread: 0</span><br><span class="line">13596:M 12 Dec 18:06:26.373 - Client closed connection</span><br><span class="line">Delete file event on fd: 6, mask: readable</span><br><span class="line">Poll and handle: END</span><br><span class="line">Poll and handle: START</span><br><span class="line">Fd: 7 is readable</span><br><span class="line">13596:M 12 Dec 18:06:26.510 - readQueryFromClient fd: 7, nread: 0</span><br><span class="line">13596:M 12 Dec 18:06:26.510 - Client closed connection</span><br><span class="line">Delete file event on fd: 7, mask: readable</span><br><span class="line">Poll and handle: END</span><br></pre></td></tr></table></figure></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>ToRapture
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://torapture.github.io/2019/12/12/Redis%E5%AD%A6%E4%B9%A0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="Redis学习 命令执行">https://torapture.github.io/2019/12/12/Redis学习-命令执行/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Redis/" rel="tag"># Redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/11/Redis%E7%AC%94%E8%AE%B0-info%E5%91%BD%E4%BB%A4/" rel="prev" title="Redis笔记 info命令">
      <i class="fa fa-chevron-left"></i> Redis笔记 info命令
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/12/15/Redis%E5%AD%A6%E4%B9%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="next" title="Redis学习 数据结构">
      Redis学习 数据结构 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F"><span class="nav-text">协议格式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E8%BF%9E%E4%B8%8E%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-text">建连与执行命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#readhandler"><span class="nav-text">ReadHandler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#writehandler"><span class="nav-text">WriteHandler</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pipeline"><span class="nav-text">Pipeline</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9E%E7%8E%B0pipeline%E8%B0%83%E7%94%A8"><span class="nav-text">命令行实现pipeline调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%AE%9E%E7%8E%B0pipeline%E8%B0%83%E7%94%A8"><span class="nav-text">Python实现pipeline调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%85%E5%90%AB%E5%A4%A7%E9%87%8F%E5%91%BD%E4%BB%A4%E7%9A%84pipeline"><span class="nav-text">包含大量命令的pipeline</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%8C%E6%97%B6%E6%89%A7%E8%A1%8Cpipeline%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88"><span class="nav-text">多个客户端同时执行Pipeline会发生什么</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ToRapture"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">ToRapture</p>
  <div class="site-description" itemprop="description">Some notes</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ToRapture" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ToRapture" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/ToRapture" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ToRapture" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:torapture@gmail.com" title="E-Mail → mailto:torapture@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ToRapture</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
